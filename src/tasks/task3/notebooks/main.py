# -*- coding: utf-8 -*-
"""main.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1HpHgqH1BX5bY9H00SOUu4OCaoIuzO_dK
"""



!pip install crewai -q

"""Main.py"""

import os
import json
from crewai import Crew
from textwrap import dedent
from advisor_agents import Night_Life_Advisor
from advisor_tasks import Advisor_Tasks

from dotenv import load_dotenv
load_dotenv()

class Advisor_Crew:

    def __init__(self, origin, destination, interests, questions):
        self.origin = origin
        self.destination = destination
        self.interests = interests
        self.questions = questions
        self.answers = []

    def ask_questions(self):
        print("Please answer the following questions:")
        for key, question in self.questions:
            if isinstance(question, str):
                answer = input(question + " ")
                self.answers.append((key, answer))
            else:
                print("Invalid question format. Skipping question.", key)

    def get_answers(self):
        return self.answers

    def run(self):
        agents = Night_Life_Advisor()
        tasks = Advisor_Tasks()

        energy_level_advisor_agent = agents.energy_level()
        musical_genre_and_culture_advisor_agent = agents.musical_genre_and_culture()
        dancing_style_preference_advisor_agent = agents.dancing_style_preference()

        energy_level_assessment_task = tasks.energy_level_assessment_task(
            energy_level_advisor_agent,
            self.origin,
            self.destination,
            self.answers,
        )

        musical_genre_and_culture_identification_task = tasks.musical_genre_and_culture_identification_task(
            musical_genre_and_culture_advisor_agent,
            self.origin,
            self.destination,
            self.interests
        )

        dancing_preference_assessment_task = tasks.dancing_preference_assessment_task(
            dancing_style_preference_advisor_agent,
            self.origin,
            self.destination,
            self.interests
        )

        crew = Crew(
            agents=[
                energy_level_advisor_agent, musical_genre_and_culture_advisor_agent, dancing_style_preference_advisor_agent
            ],
            tasks=[energy_level_assessment_task, musical_genre_and_culture_identification_task, dancing_preference_assessment_task],
            full_output=True,
            verbose=2,
            output_log_file=True,
        )

        result = crew.kickoff()
        return result

if __name__ == "__main__":

    print("## Welcome to Trip Planner Crew")
    print('-------------------------------')
    origin = input(dedent("""
      Where are you currently located?
    """))
    destination = input(dedent("""
      Where do you wish to travel in Paris?
    """))
    interests = input(dedent("""
      What are your interests?
    """))

    questions = [
        ("total_energy_level", "Are you looking for a high-energy night out with lots of dancing, socializing with a lively crowd, or a quieter environment where you can have deeper conversations?"),
        ("mood", "How would you describe your current mood? Adventurous and Spontaneous? Casual and Low-Key? Sophisticated and Classy? or Social and Outgoing?"),
        ("social_energy", "Are you in the mood to meet new people or just hang out with your friends? How much interaction are you comfortable with tonight; a lot, some, of just a little?"),
        ("cultural_background", "Are there any particular types of music or dance from your culture that you enjoy and would like to experience here in Paris? Is there a specific atmosphere that you find comfortable or enjoyable based on your cultural background?"),
        ("music_genre", "What type of music do you enjoy the most? Do you enjoy live music shows, or do you prefer DJ sets that keep the party going all night? What type of music gets you excited to go out?"),
        ("dancing_preferred", "When you think about going out, do you imagine yourself dancing the night away or sitting back and enjoying the music? How do you feel about going to places with energetic dance floors versus more laid-back lounges?"),
        ("dancing_style", "Do you prefer structured dance styles like ballroom or more free-form styles like contemporary or hip-hop? Do you like large, energetic dance floors or more intimate, cozy spots for dancing?"),
        ("watching_sports", "Do you enjoy the energy of a crowded sports bar, or do you prefer a more relaxed environment? Would you like to be in a place where you can meet and chat with other sports fans?"),
        ("how_much_drinking", "Are you looking for places where you can meet and socialize with other drinkers? Do you prefer a lively, party atmosphere or a more relaxed setting for drinking?"),
        ("personal_background", "Are there any cultural elements or themes that you enjoy in a nightlife setting, such as specific music genres, cuisines, or drinks? Do you prefer venues that attract a certain type of crowd, such as professionals, students, or a mix?"),
    ]

    advisor_crew = Advisor_Crew(origin, destination, interests, questions)
    advisor_crew.ask_questions()
    answers = advisor_crew.get_answers()
    result = advisor_crew.run()

    print("\n\n########################")
    print("## Here is the advice")
    print("########################\n")
    print(result)

    # Save the response to a text file
    filepath = "response_24.txt"

    # Convert TaskOutput objects to dictionaries
    result['tasks_outputs'] = [task_output.__dict__ for task_output in result['tasks_outputs']]

    with open(filepath, "w", encoding="utf-8") as f:
        f.write(json.dumps(result, indent=4))

